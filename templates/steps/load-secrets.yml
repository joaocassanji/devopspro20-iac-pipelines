parameters:
  - name: serviceConnectionName
    type: string

  - name: keyVaultName
    type: string

steps:
- task: AzureKeyVault@1
  displayName: Retrieve Secrets from Key Vault
  inputs:
    azureSubscription: ${{ parameters.serviceConnectionName }}
    KeyVaultName: ${{ parameters.keyVaultName }}

- bash: |
    export TF_VAR_vm_username=$VM_USERNAME
    export TF_VAR_vm_password=$VM_PASSWORD            
  env:
    VM_USERNAME: $(TF-VAR-vm-username)
    VM_PASSWORD: $(TF-VAR-vm-password)